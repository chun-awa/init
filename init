#!/bin/sh
. /etc/init.d/rc.lib
. /etc/rc.conf
if [ $$ -ne 1 ];then
    log_error "$0: must be run as PID 1"
fi

log "Mounting pseudo filesystems..."
mount -t devtmpfs dev /dev
mount -t proc proc /proc
mount -t sysfs sys /sys
mkdir /dev/pts
mkdir /dev/shm
mount -t devpts devpts /dev/pts
mount -t tmpfs tmpfs /dev/shm -o rw
ln -s /proc/self/fd /dev/fd
ln -s fd/0 /dev/stdin
ln -s fd/1 /dev/stdout
ln -s fd/2 /dev/stderr

log_info "init stage completed in $(cat /proc/uptime|cut -d ' ' -f 1)s"

for i in $(cat /proc/cmdline);do
    case $i in
        init=/init|init=init)
            :;;
        init=*)
            exec ${i#init=};;
    esac
done

exec ${INIT}
